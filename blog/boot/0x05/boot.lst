     1 00000000 8CC8                             mov ax,cs      
     2 00000002 8ED0                             mov ss,ax
     3 00000004 BC007C                           mov sp,0x7c00 ;设置栈
     4                                        
     5 00000007 2E66A1[D47C]                     mov eax,[cs:pgdt+0x7c00+0x02] 
     6 0000000C 6631D2                           xor edx,edx
     7 0000000F 66BB10000000                     mov ebx,16
     8 00000015 66F7F3                           div ebx                       
     9                                  
    10 00000018 8ED8                             mov ds,eax                    
    11 0000001A 6689D3                           mov ebx,edx  ;获取GDT基址地址和偏移地址                     
    12                                  
    13                                          ;跳过#0号描述符
    14                                          ;创建1#描述符，这是一个数据段，对应0~4GB的线性地址空间
    15 0000001D 6667C74308FFFF0000               mov dword [ebx+0x08],0x0000ffff    ;基地址为0，段界限为0xFFFFF
    16 00000026 6667C7430C0092CF00               mov dword [ebx+0x0c],0x00cf9200    ;粒度为4KB，存储器段描述符   
    17                                          ;创建保护模式下初始代码段描述符
    18 0000002F 6667C74310FF01007C               mov dword [ebx+0x10],0x7c0001ff     ;基地址为0x00007c00，界限0x1FF  
    19 00000038 6667C7431400984000               mov dword [ebx+0x14],0x00409800    ;粒度为1个字节，代码段描述符   
    20                                           ;建立保护模式下的堆栈段描述符      ;基地址为0x00007C00，界限0xFFFFE 
    21 00000041 6667C74318FEFF007C               mov dword [ebx+0x18],0x7c00fffe    
    22 0000004A 6667C7431C0096CF00               mov dword [ebx+0x1c],0x00cf9600
    23                                           ;建立保护模式下的显示缓冲区描述符   
    24 00000053 6667C74320FF7F0080               mov dword [ebx+0x20],0x80007fff    
    25 0000005C 6667C743240B924000               mov dword [ebx+0x24],0x0040920b    
    26                                           
    27                                           
    28 00000065 2EC706[D27C]2700                 mov word [cs: pgdt+0x7c00],39     
    29                                   
    30 0000006C 2E0F0116[D27C]                   lgdt [cs: pgdt+0x7c00]
    31                                          ;开启A20地址线
    32 00000072 E492                             in al,0x92                        
    33 00000074 0C02                             or al,0000_0010B
    34 00000076 E692                             out 0x92,al                       
    35                                  
    36 00000078 FA                               cli                               
    37                                  
    38 00000079 0F20C0                           mov eax,cr0
    39 0000007C 6683C801                         or eax,1
    40 00000080 0F22C0                           mov cr0,eax                      
    41                                        
    42 00000083 66EA[8B000000]1000               jmp dword 0x0010:flush            
    43                                                                             
    44                                           [bits 32]               
    45                                    flush:                                  
    46 0000008B B820000000                       mov eax,0x0020                    
    47 00000090 8EC0                             mov es,eax
    48                                  
    49 00000092 B808000000                       mov eax,0x0008
    50 00000097 8ED8                             mov ds,eax
    51                                        
    52                                           ;循环长度
    53 00000099 B917000000                       mov ecx, BootTail-BootMessage
    54 0000009E 66BE[D800]                       mov si,BootMessage
    55                                  showBootMessage:
    56 000000A2 3E678A04                        mov al,[ds:si]
    57 000000A6 268803                          mov byte [es:ebx],al
    58 000000A9 26C6430107                      mov byte [es:ebx+1],0x07
    59 000000AE 83C302                          add ebx,2
    60 000000B1 6646                            inc si
    61 000000B3 E2ED                            loop showBootMessage
    62 000000B5 EBFE                            jmp $                                         
    63                                  ;-------------------------------------------------------------------------------
    64                                  make_gdt_descriptor:                     ;构造描述符
    65                                                                           ;输入：EAX=线性基地址
    66                                                                           ;      EBX=段界限
    67                                                                           ;      ECX=属性（各属性位都在原始
    68                                                                           ;      位置，其它没用到的位置0） 
    69                                                                           ;返回：EDX:EAX=完整的描述符
    70 000000B7 89C2                             mov edx,eax
    71 000000B9 C1E010                           shl eax,16                     
    72 000000BC 6609D8                           or ax,bx                        ;描述符前32位(EAX)构造完毕
    73                                        
    74 000000BF 81E20000FFFF                     and edx,0xffff0000              ;清除基地址中无关的位
    75 000000C5 C1C208                           rol edx,8
    76 000000C8 0FCA                             bswap edx                       ;装配基址的31~24和23~16  (80486+)
    77                                        
    78 000000CA 6631DB                           xor bx,bx
    79 000000CD 09DA                             or edx,ebx                      ;装配段界限的高4位
    80                                        
    81 000000CF 09CA                             or edx,ecx                      ;装配属性 
    82                                        
    83 000000D1 C3                               ret
    84                                  ;-------------------------------------------------------------------------------
    85 000000D2 0000                             pgdt             dw 0
    86 000000D4 007E0000                                          dd 0x00007e00      ;GDT的物理地址
    87 000000D8 48656C6C6F2C204F53-     BootMessage: db "Hello, OS Protect Mode!"
    87 000000E1 2050726F7465637420-
    87 000000EA 4D6F646521         
    88                                  ;-------------------------------------------------------------------------------                             
    89 000000EF 00<rep 10Fh>            BootTail     times 510-($-$$) db 0
    90 000001FE 55AA                                        db 0x55,0xaa
